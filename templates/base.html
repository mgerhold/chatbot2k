<!doctype html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="color-scheme" content="dark"/>
    <title>{% block title %}{{ bot_name }}{% endblock %}</title>

    <link rel="preload" href="/static/style.css" as="style"/>
    <link rel="stylesheet" href="/static/style.css"/>

    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon32.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/static/favicon192.png">
    <link rel="icon" type="image/png" sizes="256x256" href="/static/favicon256.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/favicon180.png">
    <link rel="shortcut icon" href="/static/favicon32.png" type="image/png">
    <meta name="msapplication-TileImage" content="/static/favicon256.png">
    <meta name="msapplication-TileColor" content="#0d1117">
    <meta name="theme-color" content="#0d1117">

    <link rel="preload" href="/static/avatar.png" as="image"/>

    <style>
        .navbar-bell {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            margin-right: 0.75rem;
            cursor: pointer;
            border-radius: 50%;
            transition: background 0.2s ease;
        }

        .navbar-bell:hover {
            background: rgba(96, 165, 250, 0.1);
        }

        .navbar-bell svg {
            width: 24px;
            height: 24px;
            fill: none;
            stroke: var(--text);
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .navbar-bell-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            display: inline-block;
            min-width: 18px;
            padding: 0.125rem 0.35rem;
            background: #ef4444;
            color: white;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
            line-height: 1.2;
            text-align: center;
        }

        .navbar-bell-badge.read-only {
            background: rgba(255, 255, 255, 0.2);
            color: var(--text);
        }
    </style>

    {% block head_extra %}{% endblock %}
</head>
<body>
<nav class="navbar" role="navigation" aria-label="Main navigation">
    <div class="navbar-content">
        <div class="navbar-left">
            <a href="/" class="navbar-brand">
                <img src="/static/avatar.png" alt="{{ bot_name }} logo" class="navbar-logo">
                {{ bot_name }}
            </a>
            {% if current_user %}
            <a href="/viewer" class="navbar-link">Viewer Dashboard</a>
            {% endif %}
            {% if is_broadcaster %}
            <a href="/admin" class="navbar-link">Admin Dashboard</a>
            {% endif %}
        </div>
        <div class="navbar-right">
            {% if current_user %}
            <a href="{{ request.app.url_path_for('viewer_dashboard_notifications') }}" class="navbar-bell" title="Notifications">
                <svg viewBox="0 0 24 24">
                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                    <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                </svg>
                {% if unread_notifications_count > 0 %}
                <span class="navbar-bell-badge">{{ unread_notifications_count }}</span>
                {% elif total_notifications_count > 0 %}
                <span class="navbar-bell-badge read-only">{{ total_notifications_count }}</span>
                {% endif %}
            </a>
            {% if profile_image_url %}
            <img src="{{ profile_image_url | e }}" alt="{{ current_user.display_name | e }}'s profile" class="navbar-profile-pic">
            {% endif %}
            <span class="navbar-user">{{ current_user.display_name | e }} (<a href="/auth/twitch/logout" class="navbar-link">logout</a>)</span>
            {% else %}
            <a href="/login" class="navbar-link">Login</a>
            {% endif %}
        </div>
    </div>
</nav>
<main class="container">
    {% block header %}{% endblock %}

    {% block content %}{% endblock %}

    <footer class="footer" role="contentinfo" aria-label="Site footer">
        <small>© {{ copyright_year or "2025" }} {{ author_name | e }} — All rights reserved.</small>
        <span class="sep" aria-hidden="true">·</span>
        {% block footer_links %}
        <a href="/imprint">Imprint</a>
        {% endblock %}
    </footer>
</main>
</body>
</html>
